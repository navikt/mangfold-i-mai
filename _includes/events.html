{% assign number-of-events = 0 %}
{% assign events = collections.event | sort: 'data.event-date' %}

{% for event in events %}
  {% assign event-date = event.data.event-date | readableDate: "dd" %}

  {% if date == event-date %}
    {% assign number-of-events = number-of-events | plus:1 %}
    {% assign event-weekday = event.data.event-date | readableDate: "d" %}
  {% endif %}
{% endfor %}

{% if number-of-events > 0 %}
    <section class="series__day">
      {% assign dates = collections.dates %}
      {% for day in dates %}
      {% assign day-date = day.data.event-date | readableDate: "dd" %}
      {% if day-date == date %}
        <a class="dateblob {% if number-of-events >= 2 %}dateblob--sticky{% endif %}" href="/dates/{{ day.fileSlug }}.html" aria-label="{{ day.data.event-date | readableDate: 'cccc dd. LLLL' |  capitalize }}">
          <span class="dateblob__day" aria-hidden="true">
            {{ day.data.event-date | readableDate: 'ccc' | remove: '.' }}
          </span>
          <span class="dateblob__number" aria-hidden="true">
            {{ day.data.event-date | readableDate: "dd" | remove: '.' }}
          </span>
        </a>
        {% comment %}
        {% if day.data.theme %}
            <p class="theme">{{ day.data.theme }}</p>
        {% endif %}
        {% endcomment %}
      {% endif %}
      {% endfor %}

      <ul class="series__events">
          {% for event in events %}
            {% assign event-date = event.data.event-date | readableDate: "dd" %}
            {% if date == event-date %}
              <li class="series__event {{ event.privacy }} {{ event.location-type }}">
                <div class="time {% if event.data.canceled %}canceled{% endif %}">
                    <time datetime="{{ event.data.event-date | readableDate: 'T' }}">{{ event.data.event-date | readableDate: 'T' }}</time>–<time datetime="{{ event.data.event-date-end | readableDate: 'T' }}">{{ event.data.event-date-end | readableDate: 'T' }}</time>
                </div>

                <h2 class="title">
                    <a href="{{ event.url }}">
                    {% if event.data.canceled %}DESSVERRE AVLYST –{% endif %} {{ event.data.title }}
                    </a>
                </h2>

                <p>
                  {% if event.data.summary-special %}
                    {{ event.data.summary-special }}
                  {% else %}
                    {{ event.data.summary }}
                    {% if event.data.speakers %}
                      Med {{ event.data.speakers | listFormat }}.
                    {% endif %}
                  {% endif %}
                </p>

                <div class="tags">
                  {% if event.data.privacy == "public" %}
                    <span class="badge green {{ event.data.privacy }}">Åpent for alle</span>
                  {% else %}
                    <span class="badge red {{ event.data.privacy }}">Bare for NAV-ansatte</span>
                  {% endif %}

                  {% if event.data.location-type != "in-person"  %}
                    <span class="badge purple stream">Nettmøte</span>
                  {% endif %}

                  {% if event.data.location-type != "stream" %}
                    <span class="badge blue in-person">Fysisk arrangement</span>
                  {% endif %}

                  {% if event.data.registration == true or event.data.registration-link %}
                    <span class="badge yellow registration-required">Krever påmelding</span>
                  {% endif %}

                  {% if event.data.video-url %}
                    <span class="badge recorded">Opptak tilgjengelig</span>
                  {% elsif event.data.recorded == true %}
                    <span class="badge recorded">Blir tatt opp</span>
                  {% endif %}
                </div>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
    </section>
{% else %}
    {% if show-empty-events %}
        <p class="no-events">Ingen arrangementer i dag.</p>
    {% endif %}
{% endif %}
